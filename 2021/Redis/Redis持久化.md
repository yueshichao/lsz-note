# RDB

1. 使用save指令或bgsave完成
2. dump为二进制文件，save时会阻塞所有命令
3. bgsave为fork子进程实现
4. 宕机时为上一次dump的数据快照
5. 恢复快

> **save 300 10** 表示300s内，对数据库进行了至少10次修改，会执行一次rdb


# AOF

1. 保存的是redis协议的指令
2. AOF重写是防止aof文件过大，使用精简后的指令重写aof文件替换
   1. fork子进程（拥有数据副本）异步重写aof文件
   2. 此时有指令进入会同时写入aof缓冲区与**aof重写缓冲区**
   3. 完成后，主进程将重写缓冲区内容**写入**aof重写文件，并**替换**新旧aof文件
3. redis服务器启动会先启动伪客户端，读取aof文件，写入服务器
4. 宕机时也并非不会丢数据（写入文件时，操作系统会先写入缓冲区，等待缓冲区满或fsync指令才会写入硬盘），丢多少数据取决于**appendfsync**参数
   1. always: aof_buf同步写入硬盘
   2. everysec: 单开一个线程每秒写入硬盘
   3. no: 交由操作系统决定